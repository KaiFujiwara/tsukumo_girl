# アーキテクチャ設計

## システム構成

```
[モバイルアプリ] ←→ [APIサーバー] ←→ [AI画像生成サービス]
                                    ↓
                              [キャッシュ・ストレージ]
```

## 技術スタック

### フロントエンド（モバイルアプリ）
- **Framework**: React Native + Expo
- **言語**: TypeScript
- **状態管理**: React Hooks（useState, useEffect）
- **カメラ**: expo-camera
- **ナビゲーション**: Expo Router

### バックエンド（APIサーバー）
- **言語**: Go 1.25
- **フレームワーク**: 標準ライブラリ（net/http）
- **アーキテクチャ**: Clean Architecture
- **ホットリロード**: Air
- **コンテナ**: Docker

### インフラ・デプロイ
- **開発環境**: Docker Compose
- **本番環境**: 未定（AWS/GCP/Heroku検討中）
- **CI/CD**: 未実装（将来検討）

### AI画像生成
- **現在**: プレースホルダー（picsum.photos）
- **将来**: Stable Diffusion API / OpenAI DALL-E / Midjourney

## データフロー

### 1. バーコードスキャン
```
ユーザー → カメラ起動 → バーコード読み取り → データ抽出
```

### 2. 画像生成リクエスト
```
バーコードデータ → APIサーバー → シード生成 → AI画像生成 → レスポンス
```

### 3. 画像表示
```
APIレスポンス → 画像URL取得 → キャッシュ確認 → 画像表示
```

## APIアーキテクチャ

### ディレクトリ構成（Go）
```
api/
├── cmd/server/         # アプリケーションエントリーポイント
├── internal/           # 内部パッケージ
│   ├── domain/        # ドメイン層（ビジネスロジック）
│   ├── usecase/       # ユースケース層
│   ├── adapter/       # アダプター層（外部接続）
│   └── config/        # 設定管理
├── pkg/               # 外部公開可能パッケージ
├── build/docker/      # Dockerファイル
└── scripts/          # スクリプト類
```

### レイヤー分離
- **Domain Layer**: ビジネスルール・エンティティ
- **UseCase Layer**: アプリケーションロジック
- **Adapter Layer**: 外部システム連携（HTTP/DB/AI API）
- **Infrastructure Layer**: フレームワーク・ライブラリ

## セキュリティ設計

### API セキュリティ
- CORS設定による適切なオリジン制御
- レート制限（将来実装）
- 入力値検証・サニタイゼーション

### モバイルアプリ セキュリティ
- HTTPS通信の強制
- 機密情報のローカル保存回避
- カメラ権限の適切な管理

## スケーラビリティ

### 水平スケーリング対応
- ステートレス API設計
- ロードバランサー対応
- データベース分散（将来）

### キャッシュ戦略
- Redis利用検討（将来）
- CDN活用（将来）
- ローカルキャッシュ最適化